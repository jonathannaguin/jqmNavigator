//////////////////////////////////////////////////////////////////////////////////////
//
//    Copyright 2012 Piotr Walczyszyn (http://outof.me | @pwalczyszyn)
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//	you may not use this file except in compliance with the License.
//	You may obtain a copy of the License at
//
//		http://www.apache.org/licenses/LICENSE-2.0
//
//	Unless required by applicable law or agreed to in writing, software
//	distributed under the License is distributed on an "AS IS" BASIS,
//	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//	See the License for the specific language governing permissions and
//	limitations under the License.
//
//////////////////////////////////////////////////////////////////////////////////////
(function(root,factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else{factory(jQuery)}}(this,function($){$(document).bind("mobileinit",function(){$.mobile.linkBindingEnabled=false;$.mobile.ajaxEnabled=false;$.mobile.hashListeningEnabled=false;$.mobile.pushStateEnabled=false;$.mobile.autoInitializePage=false;$.extend($.mobile,{jqmNavigator:{VERSION:"1.0.0",_containers:[],defaultPageContainer:null,pushView:function jqmNavigator_pushView(view,options,endCallback){var containerViews=this._getPageContainerViews(options);containerViews.views.push(view);containerViews.pageContainer.append(view.el);view.render();if(endCallback){view.$el.one("pageshow",function(){endCallback()})}if(!$.mobile.firstPage){view.$el.attr("data-role","page");if(!$.mobile.autoInitializePage){$.mobile.initializePage()}}else{$.mobile.changePage(view.$el,$.extend({role:"page",changeHash:false,pageContainer:containerViews.pageContainer},options))}},popView:function jqmNavigator_popView(options){var containerViews=this._getPageContainerViews(options);if(containerViews.views.length>1){var fromView=containerViews.views.pop();toView=containerViews.views[containerViews.views.length-1];fromView.$el.one("pagehide",function(event){fromView.remove()});$.mobile.changePage(toView.$el,$.extend({role:"page",reverse:true,changeHash:false,pageContainer:containerViews.pageContainer},options));return true}else{return false}},popBackNViews:function jqmNavigator_popBackNViews(N,options){var containerViews=this._getPageContainerViews(options);if(containerViews.views.length>1){if(containerViews.views.length-N>1){var fromView=containerViews.views.pop(),toView=containerViews.views[containerViews.views.length-N],removedViews=containerViews.views.splice((containerViews.views.length-N)+1,containerViews.views.length-1);fromView.$el.one("pagehide",function(event){removedViews.forEach(function(item){item.remove()},this);fromView.remove()});$.mobile.changePage(toView.$el,$.extend({role:"page",reverse:true,changeHash:false,pageContainer:containerViews.pageContainer},options))}else{console.log("Can't pop first view or below, you can replace it instead!")}}else{console.log("Can't pop first view, you can replace it instead!")}},popToFirst:function jqmNavigator_popToFirst(options){var containerViews=this._getPageContainerViews(options);if(containerViews.views.length>1){var fromView=containerViews.views[containerViews.views.length-1],toView=containerViews.views[0],removedViews=containerViews.views.splice(1,containerViews.views.length-1);fromView.$el.one("pagehide",function(event){removedViews.forEach(function(item){item.remove()},this)});$.mobile.changePage(toView.$el,$.extend({role:"page",reverse:true,changeHash:false,pageContainer:containerViews.pageContainer},options))}else{console.log("Can't pop first view, you can replace it instead!")}},replaceView:function jqmNavigator_replaceView(view,options){var containerViews=this._getPageContainerViews(options);if(containerViews.views.length>=1){var fromView=containerViews.views.pop();fromView.$el.one("pagehide",function(event){fromView.remove()});containerViews.views.push(view);containerViews.pageContainer.append(view.el);view.render();$.mobile.changePage(view.$el,$.extend({role:"page",changeHash:false,pageContainer:containerViews.pageContainer},options))}},replaceAll:function jqmNavigator_replaceAll(view,options){var containerViews=this._getPageContainerViews(options);if(containerViews.views.length>=1){var fromView=containerViews.views[containerViews.views.length-1],removedViews=containerViews.views.splice(0,containerViews.views.length);fromView.$el.one("pagehide",function(event){removedViews.forEach(function(item){item.remove()},this)});containerViews.views.push(view);containerViews.pageContainer.append(view.el);view.render();$.mobile.changePage(view.$el,$.extend({role:"page",changeHash:false,pageContainer:containerViews.pageContainer},options))}},_getPageContainerViews:function(options){var pageContainer=options&&options.pageContainer?options.pageContainer:$.mobile.pageContainer||this.defaultPageContainer||$("body"),result;this._containers.some(function(item){if(item.pageContainer[0]===pageContainer[0]){result=item;return true}},this);if(!result){this._containers.push(result={pageContainer:pageContainer,views:[]})}return result},getViews:function jqmNavigator_getViews(pageContainer){var views,pc=pageContainer?pageContainer[0]:($.mobile.pageContainer?$.mobile.pageContainer[0]:null);this._containers.some(function(item){if(item.pageContainer[0]===pc){views=item.views;return true}},this);return views}}})})}));
